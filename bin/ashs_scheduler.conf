#!/bin/bash
#######################################################################
#
#  Program:   ASHS (Automatic Segmentation of Hippocampal Subfields)
#  Module:    Scheduler Configuration
#  Language:  BASH Shell Script
#
#  This file is part of ASHS
#
#  ASHS is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#######################################################################

# ============================================================================
# ASHS Scheduler Configuration File
# ============================================================================
#
# This file provides a user-friendly way to configure job scheduler settings
# for ASHS. Copy this file to ~/.ashs_scheduler.conf or to your working
# directory and modify as needed.
#
# The settings here can be overridden by command-line options.
#
# ============================================================================

# ----------------------------------------------------------------------------
# SCHEDULER SELECTION
# ----------------------------------------------------------------------------
# Choose which scheduler to use. Options:
#   auto     - Auto-detect based on environment (default)
#   slurm    - SLURM workload manager
#   sge      - Sun Grid Engine / Open Grid Scheduler
#   lsf      - IBM Spectrum LSF
#   parallel - GNU Parallel (local multi-core)
#   local    - Sequential execution (no parallelism)
#
ASHS_SCHEDULER="auto"

# ----------------------------------------------------------------------------
# DEFAULT RESOURCE REQUESTS
# ----------------------------------------------------------------------------
# These are translated to scheduler-specific options automatically.
# Leave empty to use scheduler defaults.

# Default memory per job (e.g., "4G", "8000M")
ASHS_DEFAULT_MEMORY=""

# Default number of CPU cores per job
ASHS_DEFAULT_CORES=""

# Default wall time (e.g., "4:00:00" for 4 hours)
ASHS_DEFAULT_TIME=""

# Default queue/partition name
ASHS_DEFAULT_QUEUE=""

# ----------------------------------------------------------------------------
# PER-STAGE RESOURCE OVERRIDES
# ----------------------------------------------------------------------------
# Override resources for specific pipeline stages.
# Stages in ashs_main.sh:
#   1 = Template registration
#   2 = Multi-atlas registration
#   3 = Consensus voting (initial)
#   4 = Bootstrap registration
#   5 = Consensus voting (final)
#   6 = Final QA
#   7 = Statistics extraction
#
# Format: ASHS_STAGE_<N>_<RESOURCE>
# Example:
#   ASHS_STAGE_2_MEMORY="16G"
#   ASHS_STAGE_2_CORES="4"
#   ASHS_STAGE_4_MEMORY="16G"

# Stage 2 (Multi-atlas) - typically needs more memory
ASHS_STAGE_2_MEMORY=""
ASHS_STAGE_2_CORES=""
ASHS_STAGE_2_TIME=""

# Stage 4 (Bootstrap) - also memory intensive
ASHS_STAGE_4_MEMORY=""
ASHS_STAGE_4_CORES=""
ASHS_STAGE_4_TIME=""

# ----------------------------------------------------------------------------
# SCHEDULER-SPECIFIC OPTIONS
# ----------------------------------------------------------------------------
# Raw options passed directly to the scheduler. Use for options not covered
# above. These are appended to the auto-generated options.

# SLURM-specific (e.g., "--account=myaccount --gres=gpu:1")
ASHS_SLURM_EXTRA_OPTS=""

# SGE-specific (e.g., "-l h_vmem=8G -pe smp 4")
ASHS_SGE_EXTRA_OPTS=""

# LSF-specific (e.g., "-R 'rusage[mem=8000]'")
ASHS_LSF_EXTRA_OPTS=""

# GNU Parallel-specific (e.g., "-j 8 --delay 1")
ASHS_PARALLEL_EXTRA_OPTS=""

# ----------------------------------------------------------------------------
# ADVANCED OPTIONS
# ----------------------------------------------------------------------------

# Email notifications (scheduler-dependent)
# Set to your email address to receive job notifications
ASHS_NOTIFY_EMAIL=""

# Notification events (begin, end, fail, all, none)
ASHS_NOTIFY_EVENTS="fail"

# Job name prefix
ASHS_JOB_PREFIX="ashs"

# Log directory (relative to working directory)
ASHS_LOG_DIR="dump"

# ----------------------------------------------------------------------------
# AUTO-DETECTION PRIORITY
# ----------------------------------------------------------------------------
# When ASHS_SCHEDULER="auto", check for schedulers in this order.
# The first available scheduler will be used.
ASHS_SCHEDULER_PRIORITY="slurm sge lsf parallel local"
